# 差分隱私測試專案

## 專案說明
本專案實現了基於差分隱私（Differential Privacy）的資料匿名化功能，並提供了完整的測試框架來評估匿名化效果。專案使用 ARX 框架實現差分隱私保護，並提供了多種評估指標來衡量匿名化效果。

## 技術架構
- Java 17
- Spring Boot 3.2.3
- ARX Library 3.9.1
- Apache POI 5.2.5
- Swagger UI

## 系統架構

### 整體架構圖
```
+------------------+     +------------------+     +------------------+
|                  |     |                  |     |                  |
|  Client Layer    | --> |  Service Layer   | --> |  Data Layer      |
|                  |     |                  |     |                  |
+------------------+     +------------------+     +------------------+
        |                        |                        |
        v                        v                        v
+------------------+     +------------------+     +------------------+
|                  |     |                  |     |                  |
|  REST API        |     |  ARX Framework   |     |  File Storage    |
|  Swagger UI      |     |  Privacy Models  |     |  Excel/TXT       |
|                  |     |                  |     |                  |
+------------------+     +------------------+     +------------------+
```

### 系統流程圖
```
+----------------+     +----------------+     +----------------+
|                |     |                |     |                |
|  接收輸入資料   | --> |  資料預處理     | --> |  差分隱私處理   |
|                |     |                |     |                |
+----------------+     +----------------+     +----------------+
        |                     |                      |
        v                     v                      v
+----------------+     +----------------+     +----------------+
|                |     |                |     |                |
|  資料驗證      |     |  欄位類型設定   |     |  參數設定      |
|                |     |                |     |                |
+----------------+     +----------------+     +----------------+
                                                      |
                                                      v
+----------------+     +----------------+     +----------------+
|                |     |                |     |                |
|  評估指標計算   | <-- |  結果輸出      | <-- |  匿名化處理    |
|                |     |                |     |                |
+----------------+     +----------------+     +----------------+
        |                     |
        v                     v
+----------------+     +----------------+
|                |     |                |
|  Excel 報表    |     |  TXT 報表      |
|                |     |                |
+----------------+     +----------------+
```

### 模組說明

1. Client Layer（客戶端層）
   - REST API 介面
   - Swagger UI 文檔
   - 請求驗證與處理

2. Service Layer（服務層）
   - 差分隱私服務
   - 資料匿名化處理
   - 評估指標計算

3. Data Layer（資料層）
   - 檔案儲存管理
   - Excel/TXT 輸出
   - 資料格式轉換

### 主要流程說明

1. 資料輸入階段
   - 接收 JSON 格式的輸入資料
   - 驗證資料格式和內容
   - 進行資料預處理

2. 匿名化處理階段
   - 設定欄位類型和泛化層級
   - 配置差分隱私參數
   - 執行匿名化處理

3. 結果輸出階段
   - 計算評估指標
   - 生成 Excel 報表
   - 產生 TXT 格式結果

4. 評估分析階段
   - 分析匿名化效果
   - 評估資料可用性
   - 檢查隱私保護程度

## 功能特點
- 支援差分隱私（Differential Privacy）
  - 資料相依（Data Dependent）模式
  - 資料獨立（Data Independent）模式
- 支援 k-匿名化 (k-Anonymity)
- 支援 l-多樣性 (l-Diversity)
- 提供 RESTful API 介面
- 支援 JSON 格式的資料輸入和輸出
- 提供 Swagger UI 文檔

## 主要功能
1. 差分隱私匿名化
   - 支援資料相依和資料獨立兩種模式
   - 可調整 epsilon 和 delta 參數
   - 自動處理超時情況（60秒）

2. 測試框架
   - 自動生成測試資料
   - 多參數組合測試
   - 結果自動儲存（Excel 和 TXT 格式）

## API 文檔

### 資料匿名化處理

將輸入的 JSON 資料進行差分隱私處理。

**請求方式：** POST  
**端點：** `/api/differential-privacy/apply`  
**Content-Type：** application/json

#### 請求參數

```json
{
    "data": [
        {
            "年齡": "25",
            "性別": "男",
            "縣市": "台北市",
            "疾病": "感冒"
        }
    ],
    "epsilon": 4.0,           // 差分隱私參數
    "delta": 0.7,            // 差分隱私參數
    "isDataIndependent": false // 是否使用資料獨立模式
}
```

#### 回應格式

```json
{
    "epsilon": 4.0,
    "delta": 0.7,
    "isDataIndependent": false,
    "result": [
        ["20-39", "*", "台北市", "感冒"]
    ]
}
```

## 評估指標說明

本系統提供五個主要的衡量指標來評估資料匿名化的效果。以下使用一個簡單的測試資料集來說明每個指標的計算方式和意義。

### 測試資料集
原始資料：
```
年齡,性別,是否確診
25,男,1
30,女,0
25,男,1
35,女,0
40,男,1
```

匿名化後資料：
```
年齡,性別,是否確診
20-39,*,1
20-39,*,0
20-39,*,1
20-39,*,0
40-59,*,1
```

### 1. 資訊損失 (Information Loss)
評估資料匿名化後資訊的保留程度。

計算方式：
- 原始資料中「年齡」欄位有 3 個唯一值（25, 30, 35, 40）
- 匿名化後「年齡」欄位有 2 個唯一值（20-39, 40-59）
- 資訊損失 = 1 - (2/4) = 0.5

意義：
- 值越接近 0 表示資訊保留越多
- 值越接近 1 表示資訊損失越多
- 在此例中，0.5 表示中等程度的資訊損失

### 2. 效用損失 (Utility Loss)
評估資料匿名化後對統計分析的影響。

計算方式：
- 原始資料中「性別」欄位的分布：男(3), 女(2)
- 匿名化後「性別」欄位全部為 *
- 效用損失 = 1.0（完全損失）

意義：
- 值越接近 0 表示統計特性保持越好
- 值越接近 1 表示統計特性損失越多
- 在此例中，1.0 表示完全無法進行性別相關的統計分析

### 3. 隱私保障 (Privacy Guarantee)
評估資料匿名化後的隱私保護程度。

計算方式：
- 原始資料中「年齡」的熵值較低（因為值集中在 25-40）
- 匿名化後「年齡」的熵值較高（因為值被泛化為區間）
- 隱私保障 = 匿名化後熵值 / 原始熵值 ≈ 0.8

意義：
- 值越接近 1 表示隱私保護程度越高
- 值越接近 0 表示隱私保護程度越低
- 在此例中，0.8 表示較好的隱私保護

### 4. 平均值差異 (Mean Difference)
評估數值型資料的統計特性保持程度。

計算方式：
- 原始資料「年齡」平均值 = 31
- 匿名化後「年齡」區間中點平均值 = 35
- 平均值差異 = |35-31|/31 ≈ 0.13

意義：
- 值越接近 0 表示統計特性保持越好
- 值越接近 1 表示統計特性差異越大
- 在此例中，0.13 表示年齡的統計特性保持得還不錯

### 5. 分類準確率 (Classification Accuracy)
評估分類型資料的分布保持程度。

計算方式：
- 原始資料「是否確診」分布：1(3), 0(2)
- 匿名化後「是否確診」分布：1(3), 0(2)
- 分類準確率 = 1.0（完全一致）

意義：
- 值越接近 1 表示分布保持得越好
- 值越接近 0 表示分布差異越大
- 在此例中，1.0 表示確診狀態的分布完全保持

### 指標使用建議
1. 資訊損失和效用損失：關注資料的可用性
   - 如果這兩個值都接近 1，表示資料可能過度匿名化
   - 建議目標值：0.3-0.7

2. 隱私保障：關注資料的保護程度
   - 值越高越好，但要注意與資訊損失的平衡
   - 建議目標值：> 0.7

3. 平均值差異：關注數值型資料的統計特性
   - 值越低越好，表示統計特性保持得好
   - 建議目標值：< 0.2

4. 分類準確率：關注分類型資料的分布
   - 值越高越好，表示分布保持得好
   - 建議目標值：> 0.8

## 使用方式

### 開發環境設置
1. 確保已安裝 Java 17 或更高版本
2. 克隆專案
3. 使用 Maven 編譯專案：
   ```bash
   mvn clean install
   ```
4. 運行應用程式：
   ```bash
   mvn spring-boot:run
   ```

### 執行測試
1. 執行測試
   ```java
   @Test
   public void testDpDependentLoop()
   ```

2. 查看結果
   - 檢查控制台輸出的執行狀態
   - 查看生成的 Excel 和 TXT 檔案
   - 分析各項評估指標

### Swagger UI
啟動應用程式後，可以通過以下 URL 訪問 Swagger UI：
```
http://localhost:8089/swagger-ui.html
```

## 注意事項
1. 測試資料會自動生成，預設為 2000 筆
2. 匿名化過程有 60 秒的超時限制
3. 結果檔案會儲存在 C:\Ken 目錄下
4. 建議使用較新版本的 Java 運行環境

## 授權

### 專案授權
本專案採用 MIT 授權條款。

### 使用套件授權

1. Spring Boot 3.2.3
   - 授權：Apache License 2.0
   - 授權條款：https://www.apache.org/licenses/LICENSE-2.0

2. ARX Library 3.9.1
   - 授權：Apache License 2.0
   - 授權條款：https://www.apache.org/licenses/LICENSE-2.0

3. Apache POI 5.2.5
   - 授權：Apache License 2.0
   - 授權條款：https://www.apache.org/licenses/LICENSE-2.0

4. Jackson (JSON 處理)
   - 授權：Apache License 2.0
   - 授權條款：https://www.apache.org/licenses/LICENSE-2.0

5. Swagger UI
   - 授權：Apache License 2.0
   - 授權條款：https://www.apache.org/licenses/LICENSE-2.0

6. JUnit 5 (測試框架)
   - 授權：Eclipse Public License 2.0
   - 授權條款：https://www.eclipse.org/legal/epl-2.0/

7. Lombok
   - 授權：MIT License
   - 授權條款：https://opensource.org/licenses/MIT

### 授權相容性說明

本專案使用的所有套件授權均為開源授權，主要為：
1. Apache License 2.0
   - 允許商業使用
   - 允許修改
   - 允許分發
   - 允許專利使用
   - 需要保留版權聲明
   - 需要包含授權聲明

2. MIT License
   - 允許商業使用
   - 允許修改
   - 允許分發
   - 允許私人使用
   - 需要保留版權聲明

3. Eclipse Public License 2.0
   - 允許商業使用
   - 允許修改
   - 允許分發
   - 需要保留版權聲明

所有使用的套件授權均相互相容，可以安全地用於商業和非商業用途。 